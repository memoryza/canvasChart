<div style="height:100px;background:#ccc;"></div>

<canvas id="test"></canvas>
<script type="text/javascript" src="jquery.js"></script>
<meta charset="utf8">
<script type="text/javascript" src="canvas.js"></script>
<style type="text/css">
    #res {
        width: 200px;
        display: none;
        position: absolute;
        background: #ffffff;
        opacity: 0.5;
        height: 80px;
    }
</style>
<div id="res"></div>
<script type="text/javascript">
    var $log = $('#res');
    var pieCanvas = new pieChart({
        id: 'test',
        width:  362,
        height: 288,
        bgcolor: '#f9fafe',
        animate: true,
        title: {
            text: '今日资金流向',
            subtext: '(净流入123亿)',
            x: 20,
            y: 30
        },
        unit: {
            names: ['元', '万元', '亿元'],
            scales: [1, 10000, 100000000]
        },
        outercircle:{
            radius: 64,
            color: '#cccccc'
        },
        innercircle: {
            radius: 22,
            opacity: 0.4,
            name: '今日资金',
        },
        needtips: false,
        // 自己订制tips层样式
        // tipfunc: function (data) {
        //     // console.log(data)
        // },
        series:{
            radius: 60,//饼图半径
            decimal: 0,
            data: [
                {name: '主力流入', value: 176780000},
                {name: '散户流入', value: 674500000},
                {name: '散户流出', value: 47450000},
                {name: '主力流出', value: 176780000},
                {name: '测试流出', value: 1767800}
            ]
        }
    });

    // $(document).on('mousemove', '#test', function(e) {
    //     var data = pieCanvas.getAreaData(e); 
    //     var text = '';
    //     if (data) {
    //         for (var i in data) {
    //             if (i && data.hasOwnProperty(i)) {
    //                 text += i + ':' + data[i];
    //             }
    //         }
    //     }
    //     pieCanvas.log(text);
    // })
</script>
<div></div>
<canvas id="wang" width="400" height="400"></canvas>
<span id="coord"></span>
<script type="text/javascript">
    var $coord = $('#coord');
    var canvas = document.getElementById('wang');
    var ctx = canvas.getContext('2d');
    ctx.beginPath();
    ctx.moveTo(0, 200);
    ctx.lineTo(400, 200);
    ctx.moveTo(200, 0);
    ctx.lineTo(200, 400);
    ctx.strokeStyle = '#000000';
    ctx.closePath();
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(200, 200, 80, 80, 0, Math.PI * 2);
    ctx.stroke();
    $(document).on('mousemove', '#wang', function(e) {
        var coord = getRelativePosition(e);
        var angle = getSide(coord, coord);
        angle ? drawAvgPoint(angle, coord) : null;
    });

    function getCoord(x, y) {
        return {
            x: x - 200,
            y: 200 - y
        }
    }
    function drawPoint(angle, coord) {
        if (angle) console.log(coord)
    }
    function drawAvgPoint(arcAngle) {
        var newAngle = arcAngle;//计算sin需要弧度的转角
        switch (true) {
            case arcAngle >= Math.PI * 3/2:
                newAngle = 2 * Math.PI - arcAngle;
                break;
            case arcAngle >= Math.PI:
                newAngle = arcAngle - Math.PI;
                break;
            case arcAngle >= Math.PI / 2:
                newAngle = Math.PI - arcAngle;
                break;
        }

        var r = 80;
        var sinAngle = Math.sin(newAngle);
        var y = sinAngle * r;
        var x = Math.sqrt(r*r - y*y);
        console.log(sinAngle, x,y)
        y += 6;
        x += 6;
        // console.log(x, y)
        var newx, newy;
        var cornerPoint;
        switch (true) {
            // 第一象限
            case arcAngle >= Math.PI * 3/2:
                newx = 200 + x;
                newy = 200 - y;
                cornerPoint = {
                    sx: newx,
                    sy: newy,
                    cx: newx + 20,
                    cy: newy - 20,
                    ex: newx + 30,
                    ey: newy - 20
                }
                break;
            // 第二象限
            case arcAngle >= Math.PI:
                newx = 200 - x;
                newy = 200 - y;
                cornerPoint = {
                    sx: newx,
                    sy: newy,
                    cx: newx - 20,
                    cy: newy - 20,
                    ex: newx - 30,
                    ey: newy - 20
                }
                break;
            // 第三象限
            case arcAngle >= Math.PI / 2:
                newx = 200 - x;
                newy = 200 + y;
                cornerPoint = {
                    sx: newx,
                    sy: newy,
                    cx: newx - 20,
                    cy: newy + 20,
                    ex: newx - 30,
                    ey: newy + 20
                }
                break;
            // 第四象限
            default:
                newx = 200 + x;
                newy = 200 + y;
                cornerPoint = {
                    sx: newx,
                    sy: newy,
                    cx: newx + 20,
                    cy: newy + 20,
                    ex: newx + 30,
                    ey: newy + 20
                }
        }
        console.log(cornerPoint)
        ctx.beginPath();
        ctx.strokeStyle = '#f00000';
        ctx.moveTo(cornerPoint.sx, cornerPoint.sy);
        ctx.lineTo(cornerPoint.cx, cornerPoint.cy);
        ctx.moveTo(cornerPoint.cx, cornerPoint.cy);
        ctx.lineTo(cornerPoint.ex, cornerPoint.ey);
        ctx.closePath();
        ctx.stroke();
        
        ctx.fillStyle = '#f00000';
        ctx.arc(cornerPoint.ex, cornerPoint.ey, 2, 0, 2 *Math.PI);
        ctx.fill();

    }
drawAvgPoint(0.7853981633974482);
    function getSide(co) {
        var r = Math.sqrt(co.x*co.x + co.y*co.y);
        var arcAngle =  Math.asin(co.y/r);
        var angle = Math.asin(co.y/r) / Math.PI / 2 * 360;
        switch(true) {
            case co.x <= 0:
                angle = 180 - angle;
                arcAngle = Math.PI - arcAngle;
                break;
            case co.x > 0 && co.y < 0:
                angle = 360 + angle;
                arcAngle = 2 * Math.PI + arcAngle;
                break;
        }
        var text = '';
        arcAngle = 2 * Math.PI - arcAngle;
        if (r > 80) {
            text = '跑出圆外部了';
            return
        } else {
            text = '还在圆内部'
        }
        $coord.html('x:' + co.x + ';y:' + co.y + text + '；角度：' + angle + '弧度：' + arcAngle);
        return r < 80 ? arcAngle : false;
    }
    function getRelativePosition(e) {
        var mouseX, mouseY,
            canvas = e.target,
            boundingRect = canvas.getBoundingClientRect();
        if(e.touches) {
            mouseX = e.touches[0].clientX - boundingRect.left;
            mouseY = e.touches[0].clientY - boundingRect.top;
        } else {
            mouseX = e.clientX - boundingRect.left;
            mouseY = e.clientY - boundingRect.top;
        }
        return getCoord(mouseX, mouseY);
    }

</script>